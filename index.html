<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arskaflix</title>
    <style>
        /* (CSS remains unchanged for styling) */
    </style>
</head>
<body>
    <h1>Search for Movies or TV Shows</h1>
    <input type="text" id="search-input" placeholder="Enter movie or show name" />
    <button onclick="search()">Search</button>

    <div id="search-results"></div>

    <!-- Movie/Show details section -->
    <div id="movie-details" class="movie-details">
        <span class="back-button" onclick="goBack()">‚Üê Back to Search Results</span>
        <h2 id="details-title">Movie Title</h2>
        <img id="details-poster" src="" alt="Poster">
        <p id="details-plot"></p>
        <p><strong>Release Year:</strong> <span id="details-year"></span></p>

        <!-- Embed player and server selection -->
        <div id="embed-player">
            <h3>Select Server:</h3>
            <select id="server-select"></select>
            <h3>Select Season and Episode</h3>
            <label for="season-select">Season:</label>
            <select id="season-select" onchange="populateEpisodes()"></select>
            <label for="episode-select">Episode:</label>
            <select id="episode-select"></select>
            <button onclick="watchEpisode()">Watch Episode</button>

            <h3>Watch Now</h3>
            <iframe id="media-player" src="" width="640" height="360" allowfullscreen></iframe>
        </div>
    </div>

    <script>
        const OMDB_API_KEY = '431eaee8'; // Replace with your OMDb API key

        // Function to search for movies or TV shows
        function search() {
            const query = document.getElementById('search-input').value;
            const url = `https://www.omdbapi.com/?apikey=${OMDB_API_KEY}&s=${query}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.Response === "True") {
                        displayResults(data.Search);
                    } else {
                        document.getElementById('search-results').innerHTML = 'No results found.';
                    }
                })
                .catch(err => console.error(err));
        }

        // Function to display the search results
        function displayResults(results) {
            const searchResultsDiv = document.getElementById('search-results');
            searchResultsDiv.innerHTML = '';  // Clear previous results

            results.forEach(result => {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'result-item';
                resultDiv.innerHTML = `
                    <h3>${result.Title} (${result.Year})</h3>
                    <img src="${result.Poster}" alt="${result.Title} Poster" width="100">
                    <button onclick="viewDetails('${result.imdbID}', '${result.Type}')">View Details</button>
                `;
                searchResultsDiv.appendChild(resultDiv);
            });
        }

        // Function to display details for a movie or TV show
        function viewDetails(imdbID, type) {
            const url = `https://www.omdbapi.com/?apikey=${OMDB_API_KEY}&i=${imdbID}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    displayMovieDetails(data, type);
                })
                .catch(err => console.error(err));
        }

        // Function to display movie or show details
        function displayMovieDetails(movie, type) {
            document.getElementById('search-results').style.display = 'none';
            document.getElementById('movie-details').style.display = 'block';

            document.getElementById('details-title').textContent = movie.Title;
            document.getElementById('details-poster').src = movie.Poster;
            document.getElementById('details-plot').textContent = movie.Plot;
            document.getElementById('details-year').textContent = movie.Year;

            const serverSelect = document.getElementById('server-select');
            serverSelect.innerHTML = `
                <option value="https://embed.su">Embed.su</option>
                <option value="https://vidsrc.to">vidsrc.to</option>
                <option value="https://vidsrc.me">vidsrc.me</option>
                <option value="https://2embed.cc">2embed.cc</option>
                <option value="https://superembed.stream">superembed.stream</option>
            `;

            if (type === "movie") {
                const embedUrl = `https://embed.su/embed/movie/${movie.imdbID}`;
                document.getElementById('media-player').src = embedUrl;

                serverSelect.addEventListener('change', function() {
                    const selectedServer = this.value;
                    const newEmbedUrl = selectedServer === 'https://superembed.stream' 
                        ? `https://multiembed.mov/?video_id=${movie.imdbID}` 
                        : `${selectedServer}/embed/movie/${movie.imdbID}`;
                    document.getElementById('media-player').src = newEmbedUrl;
                });
            } else if (type === "series") {
                fetchSeasons(movie.imdbID);
            }
        }

        // Function to fetch and display available seasons
        async function fetchSeasons(imdbID) {
            const seasonSelect = document.getElementById('season-select');
            seasonSelect.innerHTML = ''; // Clear previous options
            const episodeSelect = document.getElementById('episode-select');
            episodeSelect.innerHTML = ''; // Clear episodes as well

            let season = 1;
            let keepFetching = true;

            while (keepFetching) {
                const response = await fetch(`https://www.omdbapi.com/?apikey=${OMDB_API_KEY}&i=${imdbID}&Season=${season}`);
                const data = await response.json();

                if (data.Response === "True") {
                    const option = document.createElement('option');
                    option.value = season;
                    option.textContent = `Season ${season}`;
                    seasonSelect.appendChild(option);
                    season++;
                } else {
                    keepFetching = false;
                }
            }

            populateEpisodes(imdbID, seasonSelect.value);
        }

        // Function to populate episodes based on selected season
        async function populateEpisodes() {
            const imdbID = document.getElementById('details-title').getAttribute('data-imdbid');
            const selectedSeason = document.getElementById('season-select').value;
            const episodeSelect = document.getElementById('episode-select');
            episodeSelect.innerHTML = ''; // Clear previous options

            const response = await fetch(`https://www.omdbapi.com/?apikey=${OMDB_API_KEY}&i=${imdbID}&Season=${selectedSeason}`);
            const data = await response.json();

            if (data.Response === "True") {
                data.Episodes.forEach(episode => {
                    const option = document.createElement('option');
                    option.value = episode.Episode;
                    option.textContent = `Episode ${episode.Episode}: ${episode.Title}`;
                    episodeSelect.appendChild(option);
                });
            }
        }

        // Function to watch the selected episode
        function watchEpisode() {
            const selectedServer = document.getElementById('server-select').value;
            const imdbID = document.getElementById('details-title').getAttribute('data-imdbid');
            const season = document.getElementById('season-select').value;
            const episode = document.getElementById('episode-select').value;
            const mediaPlayer = document.getElementById('media-player');

            let embedUrl = '';
            if (selectedServer === 'https://vidsrc.to') {
                embedUrl = `${selectedServer}/embed/tv/${imdbID}/${season}/${episode}`;
            } else if (selectedServer === 'https://vidsrc.me') {
                embedUrl = `${selectedServer}/embed/tv?tmdb=${imdbID}&season=${season}&episode=${episode}`;
            } else if (selectedServer === 'https://2embed.cc') {
                embedUrl = `${selectedServer}/embedtv/${imdbID}&s=${season}&e=${episode}`;
            } else if (selectedServer === 'https://superembed.stream') {
                embedUrl = `https://multiembed.mov/?video_id=${imdbID}&s=${season}&e=${episode}`;
            } else if (selectedServer === 'https://embed.su') {
                embedUrl = `${selectedServer}/embed/tv/${imdbID}/${season}/${episode}`;
            }

            mediaPlayer.src = embedUrl;
        }

        function goBack() {
            document.getElementById('movie-details').style.display = 'none';
            document.getElementById('search-results').style.display = 'block';
        }
    </script>
</body>
</html>
